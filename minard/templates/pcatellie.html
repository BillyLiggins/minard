{% extends "layout.html" %}
{% block title %}PCA TELLIE{% endblock %}
{% block head %}
{{ super() }}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/pca.css') }}" media="screen">
{% endblock %}
{% block body %}
    {{ super() }}
    <!-- <div class="col-md-10 col-md-offset-1">  -->
    <div class="container"> 
        
        <h2>PCA TELLIE Status </h2>

        <div class="row">
            <div class="panel panel-default pull-left">
                <div class="panel-heading">
                    <h3 class="panel-title">Filters</h3>
                </div>
                <div class="panel-body">
            
                    <form class="form-horizontal" role="form"
                     id="filter_controls">
                    <div class="form-group">
                        <label for="start_run" class="col-md-4 control-label">
                            Start Run
                        </label>
                        <div class="col-md-6">
                            <input type="text" class="form-control"
                             name="start_run"
                             id="start_run" placeholder="Run number"
                             {{ 'value=%s' % (start_run) if
                                 start_run > 0 else "" }}> 
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-10">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox"
                                     name="installed_only"
                                     value="1"
                                     {{ "checked" if installed_only else ""}}
                                     onchange="$('#filter_controls').submit();">
                                    Show installed fibers only
                                </label>
                            </div>
                        </div>
                    </div>            
                    </form>

                </div>
            </div>

            
            <div class="panel panel-default pull-right">
                <div class="panel-heading">
                    <h3 class="panel-title">Fiber status legend</h3>
                </div>
                <div class="panel-body">      
                    <div class="pca-fiber-cell pca-fiber-dead">
                        Dead
                    </div>
                    <div class="pca-fiber-cell pca-fiber-vacant">
                        Not installed
                    </div>      
                    <div class="pca-fiber-cell pca-fiber-installed">
                        No data
                    </div>
                    <div class="pca-fiber-cell pca-fiber-fail">
                        Fail
                    </div>
                    <div class="pca-fiber-cell pca-fiber-success">
                        Success
                    </div>  
                </div>   
            </div>
        
        </div>
    
        {% for fiber_type in ["BULK", "SPARE", "NECK"] %}
        <div class="row">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">{{ fiber_type.capitalize() }} fibers</h3>
              </div>
              <div class="panel-body">
                {% for fiber in fibers if fiber["fiber_type"] == fiber_type and not ( installed_only and not fiber["is_installed"]) %}
                <div class="{{fiber_css_class(fiber)}} pca-fiber-cell">
                    <div>
                        {{ fiber["fiber_number"] }} {{ fiber["ab"] }}
                    </div>
                    <div>
                        {{ fiber["pca_run"] }}
                    </div>
                </div>
                {% endfor %}
              </div>
            </div>
        </div>  
        {% endfor %}

        
        <h3>Details</h3>
        <table class="table table-bordered table-condensed table-striped">
            <thead>
                <tr>
                    <th>Run Number</th>
                    <th>Run Time</th>
                    <th>Ana Time</th>
                    <th>Chan.</th>
                    <th>Fiber</th>
                    <th># EXTA events</th>
                    <th>NHit(EXTA)</th>
                    <th>hit/PMT(central)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for run in runs %}
                <tr class="{{ boolclass(run["pca_status"]) }}">
                    <td><a href="/monitoring/pca_run_detail/{{ run["run_number"] }}">{{ run["run_number"] }}</a></td>
                    <td>{{ timefmt(run["run_time"]) }}</td>
                    <td>{{ timefmt(run["analyze_time"]) }}</td>
                    <td>{{ run["channel"] }}</td>
                    <td>{{ run["fiber_number"] }}</td>
                    <td>{{ run["number_events"] }}</td>
                    <td>{{ valuefmt(run["nhit"]) }}</td>
                    <td>{{ valuefmt(run["av_hit"]) }}</td>
                    <td>{{  boolfmt(run["pca_status"]) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
          
        
    </div>
    

    
{% endblock %}