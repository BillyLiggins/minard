{% extends "layout.html" %}
{% block title %}NHit{% endblock %}
{% block head %}
  {{ super() }}
  <link href="{{ url_for('static', filename='css/bar-chart.css') }}" rel="stylesheet">
  <script src="{{ url_for('static', filename='js/d3.js') }}"></script>
  <script src="{{ url_for('static', filename='js/histogram.js') }}"></script>
{% endblock %}
{% block body %}
{{ super() }}

<div class="container">
    <div class="row">
        <div class="col-md-6" id="nhit10">
            <h2>NHit (10 seconds)</h2>
        </div>
        <div class="col-md-6" id="nhit60">
            <h2>NHit (60 seconds)</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6" id="nhit10-log">
            <h2>NHit-Log (10 seconds)</h2>
        </div>
        <div class="col-md-6" id="nhit60-log">
            <h2>NHit-Log (60 seconds)</h2>
        </div>
    </div>
</div>

<script>
    var chart = histogram().xlabel('NHit').margin({'left': 50}).bins(100);
    var chart_log = histogram().xlabel('NHit').margin({'left': 50}).bins(100).log(true);

    function update_chart(selector, seconds, update)
    {
        $.getJSON($SCRIPT_ROOT + '/query', {'name': 'nhit', 'seconds': seconds}, function(reply) {
            d3.select(selector).datum(reply.value).call(chart);
            d3.select(selector + '-log').datum(reply.value).call(chart_log);
        });
        setTimeout(function() { update_chart(selector, seconds, update); }, update*1000);
    }

    update_chart('#nhit10', 10, 2);
    update_chart('#nhit60', 60, 10);

    $("#nav-nhit").attr("class","active");
</script>
{% endblock %}
